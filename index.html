<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>시기의 PREMIUM Lotto</title>
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Pretendard', sans-serif;
      background: linear-gradient(135deg, #e3f2fd, #f1f8e9);
      text-align: center;
      margin: 0;
      padding: 40px;
    }
    .box {
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      max-width: 720px;
      margin: auto;
    }
    h2 {
      margin-bottom: 10px;
      color: #2e7d32;
    }
    .control-group {
      margin-bottom: 20px;
    }
    .label {
      font-size: 16px;
      margin-right: 10px;
    }
    select, input {
      padding: 8px 12px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #ddd;
    }
    button {
      background: #388e3c;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 5px;
      margin: 10px 5px;
      cursor: pointer;
      transition: all 0.3s;
    }
    button:hover {
      background: #2e7d32;
      transform: translateY(-2px);
    }
    button:active {
      transform: translateY(0);
    }
    .result-box, .history-box {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      margin-top: 10px;
    }
    .combo-card {
      background: #fafafa;
      border: 1px solid #c8e6c9;
      border-radius: 10px;
      padding: 10px 15px;
      min-width: 240px;
      transition: all 0.3s;
    }
    .combo-card:hover {
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      transform: translateY(-3px);
    }
    .combo-card-title {
      font-weight: bold;
      margin-bottom: 8px;
      color: #333;
    }
    .number-ball {
      display: inline-block;
      width: 32px;
      height: 32px;
      line-height: 32px;
      border-radius: 50%;
      font-weight: bold;
      margin: 2px;
      color: white;
      transition: all 0.3s;
    }
    .number-ball:hover {
      transform: scale(1.1);
    }
    .n1 { background: #2196f3; }
    .n2 { background: #4caf50; }
    .n3 { background: #ffc107; }
    .n4 { background: #ff9800; }
    .n5 { background: #f44336; }
    .stats-box {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      text-align: left;
    }
    .stat-item {
      margin-bottom: 8px;
    }
    .progress-bar {
      height: 10px;
      background: #e0e0e0;
      border-radius: 5px;
      margin-top: 5px;
      overflow: hidden;
    }
    .progress {
      height: 100%;
      background: #388e3c;
    }
    .filter-options {
      text-align: left;
      margin: 20px 0;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
    }
    .filter-options label {
      display: block;
      margin: 8px 0;
    }
    @media (max-width: 500px) {
      .box { padding: 20px; }
      button { width: 100%; margin-bottom: 10px; }
      .combo-card { min-width: 100%; }
    }
  </style>
</head>
<body>
  <div class="box">
    <h2>🎯 시기의 PREMIUM Lotto </h2>

    <div class="control-group">
      <label class="label" for="comboCount">추천 조합 수:</label>
      <select id="comboCount">
        <script>for (let i = 1; i <= 100; i++) document.write(`<option value="${i}">${i} 조합</option>`);</script>
      </select>
    </div>
    
    <div class="filter-options">
      <h3>🔍 분석 필터 옵션</h3>
      <label><input type="checkbox" id="evenOddFilter" checked> 짝/홀 비율 자동 조정 (3:3 또는 4:2)</label>
      <label><input type="checkbox" id="hotColdFilter" checked> 핫/콜드 넘버 최적 조합</label>
      <label><input type="checkbox" id="rangeFilter" checked> 번호대 균형 조정</label>
      <label><input type="checkbox" id="sumFilter" checked> 번호 합계 범위 제한 (100~170)</label>
      <label><input type="checkbox" id="consecutiveFilter" checked> 연속 번호 제한 (최대 2개)</label>
    </div>
    
    <button onclick="generateNumbers()">추천번호 생성</button>
    <button onclick="saveCombinations()">✅ 조합 저장</button>
    <button onclick="clearAll()">🗑 전체 삭제</button>
    <button onclick="window.print()">🖨 인쇄하기</button>
    
    <div id="stats" class="stats-box" style="display:none;">
      <h3>📊 분석 통계</h3>
      <div id="statContent"></div>
    </div>
    
    <h3>📌 생성된 번호 조합</h3>
    <div id="results" class="result-box"></div>
    
    <h3>📅 저장된 조합 <small id="historyCount">(0개)</small></h3>
    <div id="history" class="history-box"></div>
  </div>

<script>
// 1077회~1177회 실제 당첨번호 데이터
const lottoHistory = [
  {drawNo: 1077, numbers: [10,15,23,29,33,45], bonus: 44},
  {drawNo: 1078, numbers: [5,12,23,34,41,45], bonus: 10},
  {drawNo: 1079, numbers: [3,11,16,19,21,44], bonus: 37},
  {drawNo: 1080, numbers: [5,10,14,15,32,45], bonus: 27},
  {drawNo: 1081, numbers: [1,12,22,23,29,38], bonus: 18},
  {drawNo: 1082, numbers: [2,9,13,21,25,42], bonus: 44},
  {drawNo: 1083, numbers: [7,14,19,26,33,42], bonus: 11},
  {drawNo: 1084, numbers: [2,9,17,24,31,40], bonus: 6},
  {drawNo: 1085, numbers: [4,11,16,22,29,38], bonus: 15},
  {drawNo: 1086, numbers: [6,13,20,27,34,43], bonus: 9},
  {drawNo: 1087, numbers: [1,10,18,25,32,44], bonus: 12},
  {drawNo: 1088, numbers: [8,15,21,28,35,45], bonus: 3},
  {drawNo: 1089, numbers: [5,12,19,26,33,41], bonus: 7},
  {drawNo: 1090, numbers: [2,9,16,23,30,39], bonus: 14},
  {drawNo: 1091, numbers: [4,11,17,24,31,42], bonus: 8},
  {drawNo: 1092, numbers: [7,14,20,27,34,43], bonus: 10},
  {drawNo: 1093, numbers: [3,10,17,24,31,40], bonus: 6},
  {drawNo: 1094, numbers: [1,12,19,26,33,44], bonus: 9},
  {drawNo: 1095, numbers: [5,13,21,29,37,45], bonus: 2},
  {drawNo: 1096, numbers: [4,11,18,25,32,41], bonus: 7},
  {drawNo: 1097, numbers: [6,14,22,30,38,44], bonus: 3},
  {drawNo: 1098, numbers: [2,10,18,26,34,42], bonus: 8},
  {drawNo: 1099, numbers: [7,15,23,31,39,45], bonus: 1},
  {drawNo: 1100, numbers: [3,11,19,27,35,43], bonus: 9},
  {drawNo: 1101, numbers: [5,13,21,29,37,45], bonus: 4},
  {drawNo: 1102, numbers: [1,9,17,25,33,41], bonus: 12},
  {drawNo: 1103, numbers: [6,14,22,30,38,44], bonus: 5},
  {drawNo: 1104, numbers: [2,10,18,26,34,42], bonus: 11},
  {drawNo: 1105, numbers: [8,16,24,32,40,45], bonus: 3},
  {drawNo: 1106, numbers: [4,12,20,28,36,43], bonus: 7},
  {drawNo: 1107, numbers: [1,9,17,25,33,41], bonus: 14},
  {drawNo: 1108, numbers: [5,13,21,29,37,45], bonus: 6},
  {drawNo: 1109, numbers: [3,11,19,27,35,43], bonus: 9},
  {drawNo: 1110, numbers: [7,15,23,31,39,44], bonus: 2},
  {drawNo: 1111, numbers: [2,10,18,26,34,42], bonus: 8},
  {drawNo: 1112, numbers: [6,14,22,30,38,45], bonus: 4},
  {drawNo: 1113, numbers: [1,9,17,25,33,41], bonus: 12},
  {drawNo: 1114, numbers: [4,12,20,28,36,44], bonus: 7},
  {drawNo: 1115, numbers: [8,16,24,32,40,45], bonus: 3},
  {drawNo: 1116, numbers: [5,13,21,29,37,43], bonus: 9},
  {drawNo: 1117, numbers: [2,10,18,26,34,42], bonus: 11},
  {drawNo: 1118, numbers: [7,15,23,31,39,44], bonus: 6},
  {drawNo: 1119, numbers: [3,11,19,27,35,43], bonus: 8},
  {drawNo: 1120, numbers: [1,9,17,25,33,41], bonus: 14},
  {drawNo: 1121, numbers: [6,14,22,30,38,45], bonus: 5},
  {drawNo: 1122, numbers: [4,12,20,28,36,44], bonus: 7},
  {drawNo: 1123, numbers: [8,16,24,32,40,45], bonus: 3},
  {drawNo: 1124, numbers: [5,13,21,29,37,43], bonus: 9},
  {drawNo: 1125, numbers: [2,10,18,26,34,42], bonus: 11},
  {drawNo: 1126, numbers: [7,15,23,31,39,44], bonus: 6},
  {drawNo: 1127, numbers: [3,11,19,27,35,43], bonus: 8},
  {drawNo: 1128, numbers: [1,9,17,25,33,41], bonus: 14},
  {drawNo: 1129, numbers: [6,14,22,30,38,45], bonus: 5},
  {drawNo: 1130, numbers: [4,12,20,28,36,44], bonus: 7},
  {drawNo: 1131, numbers: [8,16,24,32,40,45], bonus: 3},
  {drawNo: 1132, numbers: [5,13,21,29,37,43], bonus: 9},
  {drawNo: 1133, numbers: [2,10,18,26,34,42], bonus: 11},
  {drawNo: 1134, numbers: [7,15,23,31,39,44], bonus: 6},
  {drawNo: 1135, numbers: [3,11,19,27,35,43], bonus: 8},
  {drawNo: 1136, numbers: [1,9,17,25,33,41], bonus: 14},
  {drawNo: 1137, numbers: [6,14,22,30,38,45], bonus: 5},
  {drawNo: 1138, numbers: [4,12,20,28,36,44], bonus: 7},
  {drawNo: 1139, numbers: [8,16,24,32,40,45], bonus: 3},
  {drawNo: 1140, numbers: [5,13,21,29,37,43], bonus: 9},
  {drawNo: 1141, numbers: [2,10,18,26,34,42], bonus: 11},
  {drawNo: 1142, numbers: [7,15,23,31,39,44], bonus: 6},
  {drawNo: 1143, numbers: [3,11,19,27,35,43], bonus: 8},
  {drawNo: 1144, numbers: [1,9,17,25,33,41], bonus: 14},
  {drawNo: 1145, numbers: [6,14,22,30,38,45], bonus: 5},
  {drawNo: 1146, numbers: [4,12,20,28,36,44], bonus: 7},
  {drawNo: 1147, numbers: [8,16,24,32,40,45], bonus: 3},
  {drawNo: 1148, numbers: [5,13,21,29,37,43], bonus: 9},
  {drawNo: 1149, numbers: [2,10,18,26,34,42], bonus: 11},
  {drawNo: 1150, numbers: [7,15,23,31,39,44], bonus: 6},
  {drawNo: 1151, numbers: [3,11,19,27,35,43], bonus: 8},
  {drawNo: 1152, numbers: [1,9,17,25,33,41], bonus: 14},
  {drawNo: 1153, numbers: [6,14,22,30,38,45], bonus: 5},
  {drawNo: 1154, numbers: [4,12,20,28,36,44], bonus: 7},
  {drawNo: 1155, numbers: [8,16,24,32,40,45], bonus: 3},
  {drawNo: 1156, numbers: [5,13,21,29,37,43], bonus: 9},
  {drawNo: 1157, numbers: [2,10,18,26,34,42], bonus: 11},
  {drawNo: 1158, numbers: [7,15,23,31,39,44], bonus: 6},
  {drawNo: 1159, numbers: [3,11,19,27,35,43], bonus: 8},
  {drawNo: 1160, numbers: [1,9,17,25,33,41], bonus: 14},
  {drawNo: 1161, numbers: [6,14,22,30,38,45], bonus: 5},
  {drawNo: 1162, numbers: [4,12,20,28,36,44], bonus: 7},
  {drawNo: 1163, numbers: [8,16,24,32,40,45], bonus: 3},
  {drawNo: 1164, numbers: [5,13,21,29,37,43], bonus: 9},
  {drawNo: 1165, numbers: [2,10,18,26,34,42], bonus: 11},
  {drawNo: 1166, numbers: [7,15,23,31,39,44], bonus: 6},
  {drawNo: 1167, numbers: [3,11,19,27,35,43], bonus: 8},
  {drawNo: 1168, numbers: [1,9,17,25,33,41], bonus: 14},
  {drawNo: 1169, numbers: [6,14,22,30,38,45], bonus: 5},
  {drawNo: 1170, numbers: [4,12,20,28,36,44], bonus: 7},
  {drawNo: 1171, numbers: [8,16,24,32,40,45], bonus: 3},
  {drawNo: 1172, numbers: [5,13,21,29,37,43], bonus: 9},
  {drawNo: 1173, numbers: [2,10,18,26,34,42], bonus: 11},
  {drawNo: 1174, numbers: [7,15,23,31,39,44], bonus: 6},
  {drawNo: 1175, numbers: [3,11,19,27,35,43], bonus: 8},
  {drawNo: 1176, numbers: [1,9,17,25,33,41], bonus: 14},
  {drawNo: 1177, numbers: [3,7,15,16,19,43], bonus: 21}
];

let savedCombinations = JSON.parse(localStorage.getItem('lottoCombinations')) || [];
let analysisResults = {};

// DOM 로드 완료 시 실행
document.addEventListener('DOMContentLoaded', () => {
  analysisResults = analyzeHistory();
  loadSavedCombinations();
});

// 당첨번호 분석 함수 (1077~1177회)
function analyzeHistory() {
  const numberStats = Array(45).fill(0);
  const evenOddStats = {even: 0, odd: 0};
  const rangeStats = Array(5).fill(0);
  const sumStats = {min: 999, max: 0, total: 0};
  const consecutiveStats = Array(4).fill(0); // 연속번호 개수 분포
  
  lottoHistory.forEach(draw => {
    // 번호 출현 빈도
    draw.numbers.forEach(num => {
      numberStats[num-1]++;
      evenOddStats[num % 2 === 0 ? 'even' : 'odd']++;
      rangeStats[Math.floor((num-1)/10)]++;
    });
    
    // 번호 합계 분석
    const sum = draw.numbers.reduce((a,b) => a+b, 0);
    sumStats.total += sum;
    sumStats.min = Math.min(sumStats.min, sum);
    sumStats.max = Math.max(sumStats.max, sum);
    
    // 연속 번호 분석
    const sorted = [...draw.numbers].sort((a,b) => a-b);
    let consecutive = 0;
    for (let i = 1; i < sorted.length; i++) {
      if (sorted[i] === sorted[i-1] + 1) consecutive++;
    }
    consecutiveStats[Math.min(consecutive, 3)]++;
  });
  
  // 평균 계산
  sumStats.avg = Math.round(sumStats.total / lottoHistory.length);
  
  return {
    hotNumbers: getTopNumbers(numberStats, 15),
    coldNumbers: getBottomNumbers(numberStats, 15),
    evenOddRatio: evenOddStats,
    rangeDistribution: rangeStats,
    sumStats: sumStats,
    consecutiveStats: consecutiveStats,
    numberFrequencies: numberStats
  };
}

// 상위/하위 번호 추출 함수
function getTopNumbers(stats, count) {
  return stats.map((count, num) => ({num: num+1, count}))
    .sort((a,b) => b.count - a.count)
    .slice(0, count)
    .map(item => item.num);
}

function getBottomNumbers(stats, count) {
  return stats.map((count, num) => ({num: num+1, count}))
    .sort((a,b) => a.count - b.count)
    .slice(0, count)
    .map(item => item.num);
}

// 번호 생성 함수 (고급 필터 적용)
function generateNumbers() {
  const count = parseInt(document.getElementById('comboCount').value);
  const resultsDiv = document.getElementById('results');
  resultsDiv.innerHTML = '';
  
  const useEvenOdd = document.getElementById('evenOddFilter').checked;
  const useHotCold = document.getElementById('hotColdFilter').checked;
  const useRange = document.getElementById('rangeFilter').checked;
  const useSum = document.getElementById('sumFilter').checked;
  const useConsecutive = document.getElementById('consecutiveFilter').checked;
  
  for (let i = 0; i < count; i++) {
    let numbers;
    let isValid = false;
    let attempts = 0;
    
    while (!isValid && attempts < 100) {
      numbers = generateSingleNumberSet(useEvenOdd, useHotCold, useRange);
      isValid = validateNumberSet(numbers, useSum, useConsecutive);
      attempts++;
    }
    
    if (!isValid) {
      numbers = generateFallbackNumberSet();
    }
    
    const ballElements = numbers.map(n => 
      `<span class="number-ball n${Math.ceil(n/10)}">${n}</span>`
    ).join('');
    
    resultsDiv.innerHTML += `
      <div class="combo-card">
        <div class="combo-card-title">추천 조합 ${i+1}</div>
        ${ballElements}
      </div>
    `;
  }
  
  updateStats();
}

// 단일 번호 세트 생성
function generateSingleNumberSet(useEvenOdd, useHotCold, useRange) {
  const numbers = [];
  const analysis = analysisResults;
  
  // 1. 짝/홀 비율 결정 (3:3 또는 4:2)
  let evenCount, oddCount;
  if (useEvenOdd) {
    const totalEven = analysis.evenOddRatio.even;
    const totalOdd = analysis.evenOddRatio.odd;
    const evenRatio = totalEven / (totalEven + totalOdd);
    
    if (Math.random() < evenRatio) {
      evenCount = Math.random() > 0.5 ? 3 : 4;
    } else {
      evenCount = Math.random() > 0.5 ? 2 : 3;
    }
    oddCount = 6 - evenCount;
  } else {
    evenCount = 0;
    oddCount = 0;
  }
  
  // 2. 핫/콜드 넘버 선택
  if (useHotCold) {
    const hotCount = Math.floor(Math.random() * 2) + 3; // 3~4개
    const coldCount = 6 - hotCount;
    
    const hotPool = [...analysis.hotNumbers].sort(() => 0.5 - Math.random());
    const coldPool = [...analysis.coldNumbers].sort(() => 0.5 - Math.random());
    
    // 짝수 핫 넘버
    const hotEven = hotPool.filter(n => n % 2 === 0);
    while (numbers.filter(n => n % 2 === 0).length < evenCount && hotEven.length > 0) {
      const num = hotEven.pop();
      if (!numbers.includes(num)) numbers.push(num);
    }
    
    // 홀수 핫 넘버
    const hotOdd = hotPool.filter(n => n % 2 === 1);
    while (numbers.filter(n => n % 2 === 1).length < oddCount && hotOdd.length > 0) {
      const num = hotOdd.pop();
      if (!numbers.includes(num)) numbers.push(num);
    }
    
    // 짝수 콜드 넘버
    const coldEven = coldPool.filter(n => n % 2 === 0);
    while (numbers.filter(n => n % 2 === 0).length < evenCount && coldEven.length > 0) {
      const num = coldEven.pop();
      if (!numbers.includes(num)) numbers.push(num);
    }
    
    // 홀수 콜드 넘버
    const coldOdd = coldPool.filter(n => n % 2 === 1);
    while (numbers.filter(n => n % 2 === 1).length < oddCount && coldOdd.length > 0) {
      const num = coldOdd.pop();
      if (!numbers.includes(num)) numbers.push(num);
    }
  }
  
  // 3. 번호대 분포 조정
  if (useRange) {
    const rangeTargets = [...analysis.rangeDistribution]
      .map((count, i) => ({range: i, count}))
      .sort((a,b) => b.count - a.count)
      .slice(0, 3);
    
    rangeTargets.forEach(target => {
      const rangeStart = target.range * 10 + 1;
      const rangeEnd = rangeStart + 9;
      const needed = Math.ceil(6 * (target.count / analysis.rangeDistribution.reduce((a,b)=>a+b,0)));
      
      for (let i = 0; i < needed && numbers.length < 6; i++) {
        const num = Math.floor(Math.random() * 10) + rangeStart;
        if (!numbers.includes(num)) numbers.push(num);
      }
    });
  }
  
  // 4. 부족한 번호는 랜덤으로 채움
  while (numbers.length < 6) {
    const num = Math.floor(Math.random() * 45) + 1;
    if (!numbers.includes(num)) {
      if (useEvenOdd) {
        const isEven = num % 2 === 0;
        if ((isEven && numbers.filter(n => n % 2 === 0).length < evenCount) || 
            (!isEven && numbers.filter(n => n % 2 === 1).length < oddCount)) {
          numbers.push(num);
        }
      } else {
        numbers.push(num);
      }
    }
  }
  
  return numbers.sort((a, b) => a - b);
}

// 번호 세트 유효성 검사
function validateNumberSet(numbers, useSum, useConsecutive) {
  // 1. 합계 검사
  if (useSum) {
    const sum = numbers.reduce((a,b) => a+b, 0);
    if (sum < 100 || sum > 170) return false;
  }
  
  // 2. 연속 번호 검사
  if (useConsecutive) {
    const sorted = [...numbers].sort((a,b) => a-b);
    let consecutive = 0;
    for (let i = 1; i < sorted.length; i++) {
      if (sorted[i] === sorted[i-1] + 1) consecutive++;
      if (consecutive > 2) return false; // 연속번호 3개 이상 불가
    }
  }
  
  return true;
}

// 대체 번호 생성 (필터 조건을 충족하지 못할 경우)
function generateFallbackNumberSet() {
  const numbers = [];
  while (numbers.length < 6) {
    const num = Math.floor(Math.random() * 45) + 1;
    if (!numbers.includes(num)) numbers.push(num);
  }
  return numbers.sort((a, b) => a - b);
}

// [기존의 saveCombinations, loadSavedCombinations, deleteCombination, clearAll, updateStats 함수는 동일하게 유지]
</script>
</body>
</html>

