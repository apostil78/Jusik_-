<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë‘ë¦¬ì˜ ë¡œë˜ ì¶”ì²œê¸°</title>
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Pretendard', sans-serif;
      background: linear-gradient(135deg, #e3f2fd, #f1f8e9);
      text-align: center;
      margin: 0;
      padding: 40px;
    }
    .box {
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      max-width: 720px;
      margin: auto;
    }
    h2 {
      margin-bottom: 10px;
      color: #2e7d32;
    }
    .recent-draw, .store-list {
      font-size: 16px;
      margin-bottom: 20px;
      color: #444;
      text-align: left;
    }
    .store-list ul { padding-left: 20px; text-align: left; }
    .control-group {
      margin-bottom: 20px;
    }
    .label {
      font-size: 16px;
      margin-right: 10px;
    }
    select, input {
      padding: 8px 12px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #ddd;
    }
    button {
      background: #388e3c;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 5px;
      margin: 10px 5px;
      cursor: pointer;
      transition: all 0.3s;
    }
    button:hover {
      background: #2e7d32;
      transform: translateY(-2px);
    }
    button:active {
      transform: translateY(0);
    }
    .result-box, .history-box {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      margin-top: 10px;
    }
    .combo-card {
      background: #fafafa;
      border: 1px solid #c8e6c9;
      border-radius: 10px;
      padding: 10px 15px;
      min-width: 240px;
      transition: all 0.3s;
    }
    .combo-card:hover {
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      transform: translateY(-3px);
    }
    .combo-card-title {
      font-weight: bold;
      margin-bottom: 8px;
      color: #333;
    }
    .number-ball {
      display: inline-block;
      width: 32px;
      height: 32px;
      line-height: 32px;
      border-radius: 50%;
      font-weight: bold;
      margin: 2px;
      color: white;
      transition: all 0.3s;
    }
    .number-ball:hover {
      transform: scale(1.1);
    }
    .n1 { background: #2196f3; }
    .n2 { background: #4caf50; }
    .n3 { background: #ffc107; }
    .n4 { background: #ff9800; }
    .n5 { background: #f44336; }
    .stats-box {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      text-align: left;
    }
    .stat-item {
      margin-bottom: 8px;
    }
    .progress-bar {
      height: 10px;
      background: #e0e0e0;
      border-radius: 5px;
      margin-top: 5px;
      overflow: hidden;
    }
    .progress {
      height: 100%;
      background: #388e3c;
    }
    .action-buttons {
      margin-top: 20px;
    }
    @media (max-width: 500px) {
      .box { padding: 20px; }
      button { width: 100%; margin-bottom: 10px; }
      .combo-card { min-width: 100%; }
    }
  </style>
</head>
<body>
  <div class="box">
    <h2>ğŸ¯ ë‘ë¦¬ì˜ ì •ë°€ ë¡œë˜ ì¶”ì²œê¸°</h2>
    <div class="recent-draw" id="recentDraw">ğŸ”„ ìµœì‹  íšŒì°¨ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    <div class="store-list" id="storeList">ğŸ”„ ë‹¹ì²¨ íŒë§¤ì  ë¡œë”© ì¤‘...</div>

    <div class="control-group">
      <label class="label" for="comboCount">ì¶”ì²œ ì¡°í•© ìˆ˜:</label>
      <select id="comboCount">
        <script>for (let i = 1; i <= 100; i++) document.write(`<option value="${i}">${i} ì¡°í•©</option>`);</script>
      </select>
    </div>
    
    <div class="control-group">
      <label class="label" for="genMethod">ìƒì„± ë°©ì‹:</label>
      <select id="genMethod">
        <option value="random">ì™„ì „ ë¬´ì‘ìœ„</option>
        <option value="balanced">ê· í˜• ì¡°í•© (ì§/í™€ ë¹„ìœ¨)</option>
        <option value="statistical">í†µê³„ ê¸°ë°˜ (ìì£¼ ë‚˜ì˜¨ ë²ˆí˜¸)</option>
      </select>
    </div>
    
    <button onclick="generateMultiple()">ì¶”ì²œë²ˆí˜¸ ë°›ê¸°</button>
    <button onclick="saveCombinations()">âœ… ìµœì¢… í™•ì •í•˜ê¸°</button>
    <button onclick="clearAll()">ğŸ—‘ ì „ì²´ ì‚­ì œ</button>
    <button onclick="window.print()">ğŸ–¨ ì¸ì‡„í•˜ê¸°</button>
    
    <div id="stats" class="stats-box" style="display:none;">
      <h3>ğŸ“Š ë²ˆí˜¸ í†µê³„</h3>
      <div id="statContent"></div>
    </div>
    
    <h3>ğŸ“Œ ì¶”ì²œ ë²ˆí˜¸</h3>
    <div id="results" class="result-box"></div>
    
    <h3>ğŸ“… í™•ì •ëœ ë‚´ì—­ <small id="historyCount">(0ê°œ)</small></h3>
    <div id="history" class="history-box"></div>
    
    <div class="action-buttons">
      <button onclick="exportNumbers()">ğŸ“¤ ë‚´ ë²ˆí˜¸ ë‚´ë³´ë‚´ê¸°</button>
      <button onclick="importNumbers()">ğŸ“¥ ë‚´ ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸°</button>
    </div>
  </div>

<script>
const PROXY = 'https://lotto-proxy.jshwang.workers.dev?url=';
let savedCombinations = JSON.parse(localStorage.getItem('lottoCombinations')) || [];

// DOM ë¡œë“œ ì™„ë£Œ ì‹œ ì €ì¥ëœ ì¡°í•© ë¶ˆëŸ¬ì˜¤ê¸°
document.addEventListener('DOMContentLoaded', () => {
  loadSavedCombinations();
});

// ë¡œë˜ ë²ˆí˜¸ ìƒì„± í•¨ìˆ˜
function generateLottoNumbers(method = 'random') {
  const numbers = [];
  
  if (method === 'random') {
    // ì™„ì „ ë¬´ì‘ìœ„ ìƒì„±
    while (numbers.length < 6) {
      const num = Math.floor(Math.random() * 45) + 1;
      if (!numbers.includes(num)) numbers.push(num);
    }
  } 
  else if (method === 'balanced') {
    // ì§/í™€ ê· í˜• ì¡°í•© (3:3 ë˜ëŠ” 4:2 ë¹„ìœ¨)
    const evenOddRatio = Math.random() > 0.5 ? [3, 3] : [4, 2];
    const [evenCount, oddCount] = Math.random() > 0.5 ? evenOddRatio : evenOddRatio.reverse();
    
    // ì§ìˆ˜ ìƒì„±
    while (numbers.filter(n => n % 2 === 0).length < evenCount) {
      const num = Math.floor(Math.random() * 22) * 2 + 2;
      if (num <= 45 && !numbers.includes(num)) numbers.push(num);
    }
    
    // í™€ìˆ˜ ìƒì„±
    while (numbers.filter(n => n % 2 === 1).length < oddCount) {
      const num = Math.floor(Math.random() * 23) * 2 + 1;
      if (num <= 45 && !numbers.includes(num)) numbers.push(num);
    }
  } 
  else if (method === 'statistical') {
    // í†µê³„ ê¸°ë°˜ ìƒì„± (ìì£¼ ë‚˜ì˜¨ ë²ˆí˜¸ ìœ„ì£¼)
    const hotNumbers = [10, 23, 29, 33, 37, 40]; // ì‹¤ì œë¡œëŠ” APIì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨
    const coldNumbers = [3, 8, 13, 18, 25, 35]; // ì‹¤ì œë¡œëŠ” APIì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨
    
    // í•« ë„˜ë²„ 3~4ê°œ, ì½œë“œ ë„˜ë²„ 2~3ê°œ ì¡°í•©
    const hotCount = Math.random() > 0.5 ? 4 : 3;
    const coldCount = 6 - hotCount;
    
    // í•« ë„˜ë²„ ì„ íƒ
    const shuffledHot = [...hotNumbers].sort(() => 0.5 - Math.random());
    for (let i = 0; i < hotCount; i++) {
      numbers.push(shuffledHot[i]);
    }
    
    // ì½œë“œ ë„˜ë²„ ì„ íƒ
    const shuffledCold = [...coldNumbers].sort(() => 0.5 - Math.random());
    for (let i = 0; i < coldCount; i++) {
      numbers.push(shuffledCold[i]);
    }
  }
  
  return numbers.sort((a, b) => a - b);
}

// ì—¬ëŸ¬ ì¡°í•© ìƒì„± í•¨ìˆ˜
function generateMultiple() {
  const count = parseInt(document.getElementById('comboCount').value);
  const method = document.getElementById('genMethod').value;
  const resultsDiv = document.getElementById('results');
  resultsDiv.innerHTML = '';
  
  for (let i = 0; i < count; i++) {
    const numbers = generateLottoNumbers(method);
    const ballElements = numbers.map(n => 
      `<span class="number-ball n${Math.ceil(n/10)}">${n}</span>`
    ).join('');
    
    resultsDiv.innerHTML += `
      <div class="combo-card">
        <div class="combo-card-title">ì¶”ì²œ ì¡°í•© ${i+1}</div>
        ${ballElements}
      </div>
    `;
  }
  
  // í†µê³„ ì—…ë°ì´íŠ¸
  updateStats();
}

// ì¡°í•© ì €ì¥ í•¨ìˆ˜
function saveCombinations() {
  const cards = document.querySelectorAll('#results .combo-card');
  if (cards.length === 0) return alert('ì €ì¥í•  ì¡°í•©ì´ ì—†ìŠµë‹ˆë‹¤.');
  
  cards.forEach(card => {
    const numbers = [];
    card.querySelectorAll('.number-ball').forEach(ball => {
      numbers.push(parseInt(ball.textContent));
    });
    
    savedCombinations.push({
      numbers: numbers,
      timestamp: new Date().toISOString()
    });
  });
  
  localStorage.setItem('lottoCombinations', JSON.stringify(savedCombinations));
  loadSavedCombinations();
  alert(`${cards.length}ê°œì˜ ì¡°í•©ì„ ì €ì¥í–ˆìŠµë‹ˆë‹¤!`);
}

// ì €ì¥ëœ ì¡°í•© ë¶ˆëŸ¬ì˜¤ê¸°
function loadSavedCombinations() {
  const historyDiv = document.getElementById('history');
  historyDiv.innerHTML = '';
  
  savedCombinations.forEach((combo, index) => {
    const ballElements = combo.numbers.map(n => 
      `<span class="number-ball n${Math.ceil(n/10)}">${n}</span>`
    ).join('');
    
    const date = new Date(combo.timestamp);
    const dateStr = `${date.getMonth()+1}/${date.getDate()} ${date.getHours()}:${date.getMinutes().toString().padStart(2, '0')}`;
    
    historyDiv.innerHTML += `
      <div class="combo-card">
        <div class="combo-card-title">ì €ì¥ëœ ì¡°í•© ${index+1} <small>(${dateStr})</small></div>
        ${ballElements}
        <button onclick="deleteCombination(${index})" style="margin-top:8px; padding:2px 8px; font-size:12px;">ì‚­ì œ</button>
      </div>
    `;
  });
  
  document.getElementById('historyCount').textContent = `(${savedCombinations.length}ê°œ)`;
  updateStats();
}

// ì¡°í•© ì‚­ì œ í•¨ìˆ˜
function deleteCombination(index) {
  if (confirm('ì´ ì¡°í•©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
    savedCombinations.splice(index, 1);
    localStorage.setItem('lottoCombinations', JSON.stringify(savedCombinations));
    loadSavedCombinations();
  }
}

// ì „ì²´ ì‚­ì œ í•¨ìˆ˜
function clearAll() {
  if (confirm('ëª¨ë“  ì €ì¥ëœ ì¡°í•©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
    savedCombinations = [];
    localStorage.removeItem('lottoCombinations');
    loadSavedCombinations();
    document.getElementById('results').innerHTML = '';
    document.getElementById('stats').style.display = 'none';
  }
}

// ë²ˆí˜¸ í†µê³„ ì—…ë°ì´íŠ¸
function updateStats() {
  const allNumbers = [];
  const numberCounts = Array(45).fill(0);
  
  // í˜„ì¬ ì¶”ì²œ ë²ˆí˜¸ì™€ ì €ì¥ëœ ë²ˆí˜¸ ëª¨ë‘ í¬í•¨
  document.querySelectorAll('.number-ball').forEach(ball => {
    const num = parseInt(ball.textContent);
    allNumbers.push(num);
    numberCounts[num-1]++;
  });
  
  if (allNumbers.length === 0) {
    document.getElementById('stats').style.display = 'none';
    return;
  }
  
  document.getElementById('stats').style.display = 'block';
  let statHTML = '';
  
  // ì „ì²´ ë²ˆí˜¸ ë¶„í¬
  statHTML += '<div class="stat-item"><strong>ì „ì²´ ë²ˆí˜¸ ë¶„í¬</strong>';
  for (let i = 0; i < 45; i += 10) {
    const range = numberCounts.slice(i, i+10);
    const sum = range.reduce((a, b) => a + b, 0);
    const percent = (sum / allNumbers.length * 100).toFixed(1);
    
    statHTML += `
      <div>${i+1}-${i+10}ë²ˆ: ${sum}íšŒ (${percent}%)
        <div class="progress-bar"><div class="progress" style="width:${percent}%"></div></div>
      </div>
    `;
  }
  statHTML += '</div>';
  
  // ê°€ì¥ ë§ì´ ë‚˜ì˜¨ ë²ˆí˜¸
  const sortedNumbers = numberCounts
    .map((count, index) => ({ number: index+1, count }))
    .sort((a, b) => b.count - a.count);
  
  statHTML += '<div class="stat-item"><strong>TOP 10 ë²ˆí˜¸</strong><div>';
  sortedNumbers.slice(0, 10).forEach(item => {
    const percent = (item.count / allNumbers.length * 100).toFixed(1);
    statHTML += `
      <span class="number-ball n${Math.ceil(item.number/10)}" style="margin-right:5px;">
        ${item.number} (${item.count}íšŒ)
      </span>
    `;
  });
  statHTML += '</div></div>';
  
  document.getElementById('statContent').innerHTML = statHTML;
}

// ë²ˆí˜¸ ë‚´ë³´ë‚´ê¸°
function exportNumbers() {
  if (savedCombinations.length === 0) return alert('ë‚´ë³´ë‚¼ ì¡°í•©ì´ ì—†ìŠµë‹ˆë‹¤.');
  
  const data = {
    combinations: savedCombinations,
    exportedAt: new Date().toISOString()
  };
  
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  
  const a = document.createElement('a');
  a.href = url;
  a.download = `ë¡œë˜ì¡°í•©_${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

// ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸°
function importNumbers() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json';
  
  input.onchange = e => {
    const file = e.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = event => {
      try {
        const data = JSON.parse(event.target.result);
        if (!data.combinations || !Array.isArray(data.combinations)) {
          throw new Error('ì˜ëª»ëœ íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.');
        }
        
        if (confirm(`íŒŒì¼ì—ì„œ ${data.combinations.length}ê°œì˜ ì¡°í•©ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤. ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
          savedCombinations = savedCombinations.concat(data.combinations);
          localStorage.setItem('lottoCombinations', JSON.stringify(savedCombinations));
          loadSavedCombinations();
          alert('ì¡°í•©ì„ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!');
        }
      } catch (err) {
        alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + err.message);
      }
    };
    reader.readAsText(file);
  };
  
  input.click();
}

// ìµœì‹  íšŒì°¨ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
async function fetchLatestDrawNo() {
  try {
    const res = await fetch(PROXY + encodeURIComponent('https://www.dhlottery.co.kr/gameResult.do?method=byWin'));
    const html = await res.text();
    const match = html.match(/<strong>(\d+)<\/strong>íšŒ/);
    return match ? match[1] : null;
  } catch (err) {
    console.error('íšŒì°¨ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', err);
    return null;
  }
}

// ìµœì‹  ë‹¹ì²¨ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸°
async function fetchRecentDraw() {
  const drawNo = await fetchLatestDrawNo();
  if (!drawNo) {
    document.getElementById("recentDraw").innerText = 'âŒ ìµœì‹  íšŒì°¨ ë²ˆí˜¸ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´ìš”';
    return;
  }

  try {
    const res = await fetch(PROXY + encodeURIComponent(`https://www.dhlottery.co.kr/common.do?method=getLottoNumber&drwNo=${drawNo}`));
    const d = await res.json();
    const nums = [d.drwtNo1, d.drwtNo2, d.drwtNo3, d.drwtNo4, d.drwtNo5, d.drwtNo6];
    document.getElementById("recentDraw").innerText = `ğŸ¯ ${d.drwNo}íšŒ ë‹¹ì²¨ë²ˆí˜¸: ${nums.join(', ')} + ë³´ë„ˆìŠ¤: ${d.bnusNo}`;
  } catch (err) {
    document.getElementById("recentDraw").innerText = 'âŒ ë‹¹ì²¨ë²ˆí˜¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ';
    console.error(err);
  }
}

// ë‹¹ì²¨ íŒë§¤ì  ì •ë³´ ê°€ì ¸ì˜¤ê¸°
async function fetchWinnerStores() {
  const drawNo = await fetchLatestDrawNo();
  if (!drawNo) {
    document.getElementById("storeList").innerText = 'âŒ ìµœì‹  íšŒì°¨ ë²ˆí˜¸ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´ìš”';
    return;
  }

  try {
    const res = await fetch(PROXY + encodeURIComponent(`https://www.dhlottery.co.kr/store.do?method=topStore&pageGubun=L645&drwNo=${drawNo}`));
    const html = await res.text();
    const items = [...html.matchAll(/<td class=".*?">(.*?)<\/td>/g)].map(m => m[1].replace(/<.*?>/g,''));
    const listEl = document.getElementById("storeList");
    let out = `<strong>ğŸª ${drawNo}íšŒ 1ë“± íŒë§¤ì :</strong><ul>`;
    for (let i = 0; i < items.length; i += 5) {
      out += `<li>${items[i]} / ${items[i+3]} / ${items[i+4]}</li>`;
    }
    listEl.innerHTML = out + '</ul>';
  } catch (err) {
    document.getElementById("storeList").innerText = 'âŒ íŒë§¤ì  ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ';
    console.error(err);
  }
}

// ì´ˆê¸° ë°ì´í„° ë¡œë“œ ë° ì£¼ê¸°ì  ê°±ì‹ 
fetchRecentDraw();
fetchWinnerStores();
setInterval(fetchRecentDraw, 30 * 60 * 1000);
setInterval(fetchWinnerStores, 30 * 60 * 1000);
</script>
</body>
</html>

